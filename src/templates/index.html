<!DOCTYPE html>
<html>
<head>
    <title>BetBuddy</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
        }
        .game-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .odds-table {
            width: 100%;
            border-collapse: collapse;
        }
        .odds-table th, .odds-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .best-odds {
            color: green;
            font-weight: bold;
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        .controls select, .controls input {
            padding: 8px;
            margin-right: 10px;
        }
        .odds-movement {
            font-size: 0.9em;
            color: #666;
        }
        .odds-up::after {
            content: " ↑";
            color: green;
        }
        .odds-down::after {
            content: " ↓";
            color: red;
        }
    </style>
</head>
<body>
    <h1>Available Games</h1>
    
    <div class="controls">
        <select id="sportSelect" onchange="loadGames()">
            <option value="">All Sports</option>
        </select>
        
        <select id="sortSelect" onchange="loadGames()">
            <option value="">Sort By</option>
            <option value="time">Start Time</option>
            <option value="odds">Longest Odds</option>
        </select>
        
        <input type="text" id="teamSearch" 
               placeholder="Search teams..." 
               oninput="debounce(loadGames, 300)()">
    </div>
    
    <div id="games-container">Loading games...</div>

    <script>
        function formatOdds(odds) {
            return odds > 0 ? `+${odds}` : odds;
        }

        function formatDateTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString();
        }

        // Add debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Load available sports
        async function loadSports() {
            const response = await fetch('/available_sports');
            const sports = await response.json();
            const select = document.getElementById('sportSelect');
            sports.forEach(([name, key]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = name;
                select.appendChild(option);
            });
        }
        
        async function loadGames() {
            try {
                const sport = document.getElementById('sportSelect').value;
                const sort = document.getElementById('sortSelect').value;
                const team = document.getElementById('teamSearch').value;
                
                const params = new URLSearchParams({
                    sport: sport,
                    sort: sort,
                    team: team
                });
                
                const response = await fetch(`/available_games?${params}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const container = document.getElementById('games-container');
                    container.innerHTML = `
                        <h2>${data.sport} Games (${data.game_count})</h2>
                        ${data.games.map(game => `
                            <div class="game-card">
                                <h3>${game.away_team} @ ${game.home_team}</h3>
                                <p>Start Time: ${formatDateTime(game.start_time)}</p>
                                
                                <!-- Moneyline Odds -->
                                <h4>Moneyline</h4>
                                <table class="odds-table">
                                    <tr>
                                        <th>Team</th>
                                        <th>Best Odds</th>
                                        <th>Sportsbook</th>
                                    </tr>
                                    <tr>
                                        <td>${game.home_team}</td>
                                        <td class="best-odds">${formatOdds(game.odds.moneyline.home[0].odds)}</td>
                                        <td>${game.odds.moneyline.home[0].book}</td>
                                    </tr>
                                    <tr>
                                        <td>${game.away_team}</td>
                                        <td class="best-odds">${formatOdds(game.odds.moneyline.away[0].odds)}</td>
                                        <td>${game.odds.moneyline.away[0].book}</td>
                                    </tr>
                                </table>
                                
                                <!-- Best Point Spreads -->
                                <h4>Best Point Spreads</h4>
                                <table class="odds-table">
                                    <tr>
                                        <th>Team</th>
                                        <th>Spread</th>
                                        <th>Odds</th>
                                        <th>Sportsbook</th>
                                    </tr>
                                    <tr>
                                        <td>${game.home_team}</td>
                                        <td>${game.odds.spreads.home.point}</td>
                                        <td class="best-odds">${formatOdds(game.odds.spreads.home.price)}</td>
                                        <td>${game.odds.spreads.home.book}</td>
                                    </tr>
                                    <tr>
                                        <td>${game.away_team}</td>
                                        <td>${game.odds.spreads.away.point}</td>
                                        <td class="best-odds">${formatOdds(game.odds.spreads.away.price)}</td>
                                        <td>${game.odds.spreads.away.book}</td>
                                    </tr>
                                </table>
                                
                                <!-- Best Over/Under -->
                                <h4>Best Over/Under</h4>
                                <table class="odds-table">
                                    <tr>
                                        <th>Type</th>
                                        <th>Total</th>
                                        <th>Odds</th>
                                        <th>Sportsbook</th>
                                    </tr>
                                    <tr>
                                        <td>Over</td>
                                        <td>${game.odds.totals.over.total}</td>
                                        <td class="best-odds">${formatOdds(game.odds.totals.over.odds)}</td>
                                        <td>${game.odds.totals.over.book}</td>
                                    </tr>
                                    <tr>
                                        <td>Under</td>
                                        <td>${game.odds.totals.under.total}</td>
                                        <td class="best-odds">${formatOdds(game.odds.totals.under.odds)}</td>
                                        <td>${game.odds.totals.under.book}</td>
                                    </tr>
                                </table>
                            </div>
                        `).join('')}
                    `;
                } else {
                    document.getElementById('games-container').innerHTML = 
                        `<p>Error: ${data.message}</p>`;
                }
            } catch (error) {
                document.getElementById('games-container').innerHTML = 
                    `<p>Error loading games: ${error}</p>`;
            }
        }

        // Initialize
        loadSports();
        loadGames();
        
        // Refresh every 60 seconds
        setInterval(loadGames, 60000);
    </script>
</body>
</html> 